---
type: method
title: 拉格朗日乘子法（最大熵）
tags: ['maxent', 'optimization', 'M1']
prereq: ['Shannon 熵与最大熵原则']
source: ['standard']
status: ready
---

## 什么时候用？
- 你要在约束下最大化熵（或最小化某个目标）并得到解析形式（指数族），或需要把“约束 → 乘子”写清楚。

## 输入/输出
- 输入：
  - 目标：\(H(p)=-\sum p\ln p\)（或其他凸目标）
  - 约束：\(\sum p=1\)，\(\sum p f_k = c_k\)
- 输出：
  - 最优分布 \(p^\*\)（通常是指数族）
  - 乘子 \(\lambda_k\) 的方程（需要进一步求解）

## 核心步骤（最大熵版）
1) **列出变量与约束**
   - 变量：所有 \(p_i\)
   - 约束：归一化 + 若干期望
2) **写拉格朗日函数**
\[
\mathcal{L}= -\sum_i p_i\ln p_i
+ \lambda\Big(\sum_i p_i-1\Big)
+ \sum_k \lambda_k\Big(\sum_i p_i f_k(i)-c_k\Big)
\]
3) **对每个 \(p_i\) 求导令 0**
\[
\partial_{p_i}\mathcal{L}=-(\ln p_i+1)+\lambda+\sum_k \lambda_k f_k(i)=0
\]
4) **得到指数族形式**
\[
p_i \propto \exp\Big(\sum_k \lambda_k f_k(i)\Big)
\]
5) **用约束解乘子**
   - 解析：小问题/特殊结构
   - 数值：Newton/梯度下降/对偶优化（见 E01）

## 一致性检查（必做）
- [ ] \(p_i\ge 0\)
- [ ] \(\sum_i p_i=1\)
- [ ] 约束误差 \(\|\mathbb{E}[f]-c\|\) 足够小
- [ ] 若 \(f\) 平移/缩放，乘子的变化是否符合直觉（尺度检查）

## 复杂度与注意事项
- 乘子求解一般是凸问题（线性约束 + 熵），数值上较稳；
- 但要注意数值稳定：用 log-sum-exp/减最大值避免溢出。

## 最小可运行例子
- 只有约束 \(\mathbb{E}[E]=\bar E\) ⇒ \(p_i\propto e^{-\beta E_i}\)（Boltzmann）。
