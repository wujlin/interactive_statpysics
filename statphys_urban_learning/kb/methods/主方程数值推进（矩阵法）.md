---
type: method
title: 主方程数值推进（矩阵法）
tags: ['master-equation', 'numerics', 'M8']
prereq: ['主方程 Master equation']
source: ['linear ODE basics']
status: ready
---

## 什么时候用？
- 你有有限状态的连续时间 Markov 过程（转移率矩阵 \(W\)），想计算 \(p(t)\) 随时间的演化或收敛到稳态的过程。

## 输入/输出
- 输入：
  - 初始分布 \(p(0)\)
  - 生成矩阵/速率矩阵 \(W\)（行和为 0 的形式，或转置形式）
  - 时间步长 dt、总时长 T
- 输出：
  - \(p(t)\) 的轨迹
  - 稳态近似 \(p(\infty)\)

## 核心步骤（离散化推进）
- 连续时间主方程可以写成向量形式：
\[
\frac{dp}{dt} = pW \quad(\text{行向量约定})
\]
- 最简单的 Euler：
\[
p(t+dt)=p(t)+dt\cdot p(t)W
\]
每步后把数值误差导致的负值截断/重新归一化（必要时）。

## 更稳健（推荐）
- 用矩阵指数：
\[
p(t)=p(0)\,e^{Wt}.
\]
小规模状态空间可直接用 `scipy.linalg.expm`。

## 检查
- 概率守恒：\(\sum_i p_i(t)=1\)
- 非负性：\(p_i(t)\ge 0\)
- 长时间：\(p(t)\) 收敛到稳态（若链遍历）

## 最小例子
- 见 `exercises/notebooks/E08_markov_migration.ipynb`
