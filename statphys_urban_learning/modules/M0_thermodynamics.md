# M0 热力学骨架：约束与势的语言

## Introduction（科学史/核心矛盾）

当我们描述一杯水时，我们不会也没法列出其中 \(10^{23}\) 个分子的位置和动量。相反，我们只用寥寥几个**宏观变量**来描述它：体积 \(V\)，粒子数 \(N\)，以及一个最特殊的量——**内能 \(U\)**。

为什么 \(U\) 如此特殊？因为**热力学第一定律**告诉我们能量守恒。这意味着 \(U\) 是系统的“上帝变量”，它只随系统与外界的交换而变。如果我们假设 \(U\) 完全由广延量决定，就得到了**基本热力学关系 \(U=U(S,V,N)\)**。这套语言非常完美，像一本总账一样记录了系统的所有平衡性质。

但矛盾随之而来：这本“总账”虽然完美，却没法用。
在实验室里，你很难直接控制“S（熵）”或“U（内能）”。你手里的旋钮通常是**温度 \(T\)**（恒温槽）或**压强 \(P\)**（活塞）。这就产生了一个巨大的沟壑：**上帝的语言是 \(U(S,V,N)\)，但人类的旋钮是 \(T, P, \mu\)。**

Gibbs 的天才在于用**Legendre 变换**架起了一座桥：把 \(U\) 里的自变量 \(S\) 换成其共轭量 \(T\)，从而定义出新的势函数——**自由能 \(F\) 与 \(G\)**。
- 如果你能控制 \(T\)，你就用 \(F(T,V,N)\)。
- 如果你能控制 \(T\) 和 \(P\)，你就用 \(G(T,P,N)\)。
本章的任务，就是让你在这些“语言”之间自由切换。

本章的训练目标因此很明确：先识别你控制的变量，再选对势函数，并把 \(dU,dF,dG\) 的微分关系写到不出符号错误。热力学的边界也要记住：它描述平衡与可逆记账，但不描述涨落大小与到达平衡的路径——这些将在后续系综与随机动力学中补齐。

## References（Seminal papers，SSOT）
- 本模块原始文献导读与统一书目信息见：`references/seminal_papers.md`（条目：`SP-M0-Gibbs1876-Heterogeneous`）

> **核心目标**：在本模块中，我们要学会如何用**宏观变量**（如能量、体积、粒子数）来描述系统，并掌握一套在不同控制变量间自由切换的数学工具——**Legendre 变换**。这是后续所有统计系综（微正则/正则/巨正则）的数学地基。

## 推荐学习顺序（15–30 分钟）
1) 先通读本页 Part 1–4（不要一上来就点 KB）
2) 不看书写一遍：\(dU\)、\(dF\)、\(dG\)，并标出每个势的自然变量
3) 做 `exercises/written/M0_thermo_basics.md`
4) 最后回 Swendsen Chapter 12 的 Eq 12.10–12.12 核对符号与负号

---

## Part 1：为什么统计物理需要热力学？

统计物理的目标是用微观粒子的行为解释宏观现象。但在我们能处理 \(10^{23}\) 个粒子的概率分布之前，必须先说清楚：**我们到底要预测哪些宏观量**，以及哪些量是“可控旋钮”。

热力学提供的是一套“控制 → 响应”的记账方式：你控制 \(T,P,N\) 之类的宏观变量，系统的平衡态会把你想要的响应量（\(S,V,\mu\)…）回馈给你。对城市系统也一样：在模拟每个个体的出行选择之前，你至少得先定义清楚“总预算/总出行量/平均通勤成本/准入门槛”这些宏观约束。

一旦你接受了“我们要用少数宏观量描述系统”，下一步就会立刻遇到第一个痛点：哪些量只和起点终点有关（状态函数），哪些量依赖路径（过程量）？不把这件事讲清楚，后面每一步偏导都会写错。

---

## Part 2：上帝不掷骰子，但他在乎状态函数

### 状态函数 vs 过程量
如果你从北京去上海，你的**路费**（W+Q）取决于你怎么走（飞机、高铁还是徒步），这是一个**过程量（Process quantity）**。
但两地的**海拔差**（$\Delta U$）只取决于起点和终点，与路径无关，这是一个**状态函数（State function）**。

热力学第一定律 $\Delta U = Q - W$ 实质上是在说：虽然热量 $Q$ 和功 $W$ 都是过程量，用来“交换能量”，但它们凑在一起后的净效应 $\Delta U$ 必须是一个确定的状态改变。

> **深入理解（可选）**
> - 状态函数/过程量的定义与误区清单：[[状态函数与过程量 State vs process quantities]]
> - 守恒与方向性的基石：[[第一定律与第二定律 First and second law]]

到这里你已经有了一个可复用的“语法”：用 \(U(S,V,N)\) 这样的函数来记账。真正的麻烦从下一步开始——**实验上你几乎无法“直接控制熵 \(S\)”**，但你却可以很容易地控制温度 \(T\)（把系统放进恒温槽）。这就是我们迫切需要 Legendre 变换的原因。

---

## Part 3：勒让德变换——换个“控制台”

热力学势不是为了“多记几个字母”，而是为了把问题写在正确的控制变量上。

想象你在做实验：你可以用刚性盒子直接控制体积 \(V\)，也可以用活塞/重物更自然地控制压强 \(P\)。同理，你很难直接控制熵 \(S\)，但可以很容易控制温度 \(T\)。如果你继续坚持用 \(U(S,V,N)\) 书写所有关系，你会不断在“我明明控制的是 \(T\)，却在公式里出现 \(S\)”的尴尬中打转。

Legendre 变换做的就是“换控制台”：
\[
F(T,V,N) \equiv U - TS.
\]
这不是随便减一个 \(TS\)：它保证了当你改用 \(T\) 作为控制变量时，微分关系会自动把 \(S\) 变成响应量。Swendsen 在 Eq 12.10 定义了 \(F\equiv U-TS\)，并在 Eq 12.12 给出
\[
dF=-S\,dT-P\,dV+\mu\,dN,
\]
这就是你要练成肌肉记忆的“控制→响应”句式。

同理，如果你还要控制压强 $P$，你就会得到 **吉布斯自由能 $G(T, P, N)$**。

完整推导与总表分别见：[[Legendre 变换 从 U 到 F 到 G]]、[[热力学势 Thermodynamic potentials]]。

### 化学势 $\mu$：人口可变的控制杆
在城市里，人口流动是常态。当系统粒子数 $N$ 在变，我们需要一个量来控制它，这就是**化学势 $\mu$**。
$$ dU = TdS - PdV + \mu dN $$
这里 $\mu$ 是增加一个粒子带来的能量代价。在城市模型中，它对应着迁入一个新居民的“边际社会成本”或“吸引力阈值”。

更细的定义与常见误区见：[[化学势 Chemical potential]]。

---

## Part 4：城市映射：寻找你的控制变量

城市映射的关键不是“把符号一一对号入座”，而是把热力学的结构翻译成两类你每天都在用的约束语言：
1) **硬约束（fixed total）**：总预算/总出行量/总资源被严格固定；  
2) **软约束（fixed price / average）**：你不强行固定总量，而是通过价格/税率/补贴把“平均水平”钉住，让总量在波动中自洽。

这两类约束的差别，正是微正则（硬约束）与正则（软约束）的差别：前者是在给定 \(E\) 的集合里计数，后者是把能量当作“成本”并用 \(e^{-\beta E}\) 加权，从而把“难以控制的硬约束”换成“更可操作的温度/价格旋钮”。你在本章学的 Legendre 变换，本质上就是把约束从“固定 \(S\)”换成“固定 \(T\)”的最小范例；后续 M3/M4 只是把这件事推广到更复杂的约束与势函数。

| 统计物理 | 城市动力系统 |
| :--- | :--- |
| **内能 $U$** | 城市的总广义成本（通勤时间+金钱+碳排放） |
| **温度 $T$** | 随机性/噪声水平（个体的选择有多不理性） |
| **化学势 $\mu$** | 城市对他人的吸引力/准入门槛（房租、落户难度） |
| **勒让德变换** | 从“计划经济”（定死 $N$ 和 $E$）切换到“市场经济”（给定价格 $T$ 和 $\mu$，让 $N$ 和 $E$ 只有平均值稳定） |

更完整的“约束—势—可检验预测”映射见：[[约束与控制变量 在城市复杂动力建模中的作用]]。

---

## Part 5：动手时刻（Checklist）

看完了故事，现在请通过以下任务来验证你的掌握程度。

### 必读
- [ ] **Reading Guide**: [[Swendsen_Ch12_Thermodynamics]] (Chapter 12: 12.1-12.4)
  > 点击查看本章核心公式（Legendre 变换）与符号对照。

### 习题 (Exercises)
- [ ] **Written**: `exercises/written/M0_thermo_basics.md`
  - 给定 $U(S,V,N)$，试着手推导出 $F(T,V,N)$ 的全微分形式。
  - 解释为什么 $G$ 常常被称为“自由焓”或在相变中很重要？

### 验收标准
- [ ] 能不看书写出 $dU = TdS - PdV + \mu dN$。
- [ ] 看到“规模可变/开放系统”，能立刻反应出需要使用 $\mu$（或在系综里使用巨配分函数）。
