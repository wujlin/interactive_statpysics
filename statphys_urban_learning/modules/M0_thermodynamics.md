# M0 热力学骨架：约束与势的语言

## Introduction

> 阅读提示：正文中的关键术语若以 KB 链接形式出现，鼠标悬停可看“一句话定义”，点击可进入完整卡片。

当我们描述一杯水时，我们不会也没法列出其中 \(10^{23}\) 个分子的位置和动量。相反，我们只用寥寥几个**宏观变量**来描述它：体积 \(V\)，粒子数 \(N\)，以及一个最特殊的量——**内能 \(U\)**。

为什么 \(U\) 如此特殊？因为 [[第一定律与第二定律 First and second law|热力学第一定律]] 告诉我们能量守恒。这意味着 \(U\) 是系统的“总账”，它只随系统与外界的交换而变。怎么改变一个系统的内能？无非三种方式：
1. **做功**（改变体积）：外界压缩系统，注入能量 \(-P dV\)；
2. **传热**（改变熵）：外界加热系统，注入能量 \(T dS\)（这是 [[第一定律与第二定律 First and second law|热力学第二定律]] 的推论）；
3. **加料**（改变粒子数）：外界注入物质，带入能量 \(\mu dN\)。

把这三点加起来，就得到了**基本热力学关系**的微分形式：
\[ dU = TdS - PdV + \mu dN \]
这套语言非常完美，因为它把所有宏观变化的来源（热、机械、化学）都像记账一样列得清清楚楚。

但矛盾随之而来：这本“总账”虽然完美，却没法用。
在实验室里，你很难直接控制“S（熵）”或“U（内能）”。你手里的旋钮通常是**温度 \(T\)**（恒温槽）或**压强 \(P\)**（活塞）。这就产生了一个巨大的沟壑：**基本关系写成 \(U(S,V,N)\)，但可控变量往往是 \(T,P,\mu\)。**

Gibbs 的天才在于用 [[Legendre 变换 从 U 到 F 到 G|Legendre 变换]] 架起了一座桥：把难以直接固定的 \(S\) 换成更可控的 \(T\)，从而构造一组 [[热力学势 Thermodynamic potentials|热力学势]]（例如自由能 \(F,G\)）。
- 如果你能控制 \(T\)，你就用 \(F(T,V,N)\)。
- 如果你能控制 \(T\) 和 \(P\)，你就用 \(G(T,P,N)\)。
本章的任务，就是让你在这些“语言”之间自由切换。

本章的训练目标因此很明确：先识别你控制的变量，再选对势函数，并把 \(dU,dF,dG\) 的微分关系写到不出符号错误。热力学的边界也要记住：它描述平衡与可逆记账，但不描述涨落大小与到达平衡的路径——这些将在后续系综与随机动力学中补齐。

## References
- 本模块原始文献导读与统一书目信息见 [Seminal papers](/references/seminal_papers)（条目：`SP-M0-Gibbs1876-Heterogeneous`）。

> **核心目标**：在本模块中，我们要学会如何用**宏观变量**（如能量、体积、粒子数）来描述系统，并掌握一套在不同控制变量间自由切换的数学工具——**Legendre 变换**。这是后续所有统计系综（微正则/正则/巨正则）的数学地基。

## 推荐学习顺序（15–30 分钟）
1) 先通读本页 Part 1–4（不要一上来就点 KB）
2) 不看书写一遍：\(dU\)、\(dF\)、\(dG\)，并标出每个势的自然变量
3) 做 `exercises/written/M0_thermo_basics.md`
4) 最后回 Swendsen Chapter 12 的 Eq 12.10–12.12 核对符号与负号

---

## Part 1：为什么统计物理需要热力学？

统计物理的目标是用微观粒子的行为解释宏观现象。但在我们能处理 \(10^{23}\) 个粒子的概率分布之前，必须先说清楚：**我们到底要预测哪些宏观量**，以及哪些量是“可控旋钮”。

热力学提供的是一套“控制 → 响应”的记账方式：你控制 \(T,P,N\) 之类的宏观变量，系统的平衡态会把你想要的响应量（\(S,V,\mu\)…）回馈给你。对城市系统也一样：在模拟每个个体的出行选择之前，你至少得先定义清楚“总预算/总出行量/平均通勤成本/准入门槛”这些宏观约束。

一旦你接受了“我们要用少数宏观量描述系统”，下一步就会立刻遇到第一个痛点：哪些量只和起点终点有关（状态函数），哪些量依赖路径（过程量）？不把这件事讲清楚，后面每一步偏导都会写错。

---

## Part 2：上帝不掷骰子，但他在乎状态函数

### 状态函数 vs 过程量
如果你从北京去上海，你的**路费**（W+Q）取决于你怎么走（飞机、高铁还是徒步），这是一个**过程量（Process quantity）**。
但两地的**海拔差**（$\Delta U$）只取决于起点和终点，与路径无关，这是一个**状态函数（State function）**。

热力学第一定律 $\Delta U = Q - W$ 实质上是在说：虽然热量 $Q$ 和功 $W$ 都是过程量，用来“交换能量”，但它们凑在一起后的净效应 $\Delta U$ 必须是一个确定的状态改变。

> **深入理解（可选）**
> - 状态函数/过程量的定义与误区清单：[[状态函数与过程量 State vs process quantities]]
> - 守恒与方向性的基石：[[第一定律与第二定律 First and second law]]

到这里你已经有了一个可复用的“语法”：用 \(U(S,V,N)\) 这样的函数来记账。真正的麻烦从下一步开始——实验上你几乎无法“**直接控制熵 \(S\)**”，但你却可以很容易地控制温度 \(T\)（把系统放进恒温槽）。这就是我们迫切需要 Legendre 变换的原因。

---

## Part 3：勒让德变换——换个“控制台”

热力学势不是为了“多记几个字母”，而是为了把问题写在正确的控制变量上。

想象你在做实验：你可以用刚性盒子直接控制体积 \(V\)，也可以用活塞/重物更自然地控制压强 \(P\)。同理，你很难直接控制熵 \(S\)，但可以很容易控制温度 \(T\)。如果你继续坚持用 \(U(S,V,N)\) 书写所有关系，你会不断在“我明明控制的是 \(T\)，却在公式里出现 \(S\)”的尴尬中打转。

Legendre 变换做的就是“换控制台”：
\[
F(T,V,N) \equiv U - TS.
\]
这不是随便减一个 \(TS\)：它保证了当你改用 \(T\) 作为控制变量时，微分关系会自动把 \(S\) 变成响应量。Swendsen 在 Eq 12.10 定义了 \(F\equiv U-TS\)，并在 Eq 12.12 给出
\[
dF=-S\,dT-P\,dV+\mu\,dN,
\]
这就是你要练成肌肉记忆的“控制→响应”句式。

同理，如果你还要控制压强 $P$，你就会得到 **吉布斯自由能 $G(T, P, N)$**。

完整推导与总表分别见：[[Legendre 变换 从 U 到 F 到 G]]、[[热力学势 Thermodynamic potentials]]。

### 化学势 $\mu$：人口可变的控制杆
在城市里，人口流动是常态。当系统粒子数 $N$ 在变，我们需要一个量来控制它，这就是**化学势 $\mu$**。
$$ dU = TdS - PdV + \mu dN $$
这里的 \(\mu\) 是与规模 \(N\) 共轭的量：在热力学里它是能量/自由能对 \(N\) 的边际变化率；在开放系统里，外部环境等价于“设定”一个 \(\mu\)，从而决定系统的平均规模。放到城市 mobility 语境，你可以先把它当作“控制平均人口/事件数的对偶参数（影子价格/拉格朗日乘子）”；至于把它解释成外部机会成本、准入门槛还是吸引力基线，取决于你把 \(E\) 写成成本还是效用（符号约定会在 Part 4 给出）。

更细的定义与常见误区见：[[化学势 Chemical potential]]。

---

## Part 4：城市映射：寻找你的控制变量

这部分只做一件事：把“控制变量/约束”的语言翻译到你关心的人口 mobility 场景里，避免把符号硬对号入座。

### 1) 先说清：我们在城市里“统计”的是什么？
- **微观态 \(x\)**：所有个体的具体实现（谁从哪迁到哪、每个人选哪条路径/目的地等）。
- **代价函数 \(E(x)\)**：给每个微观态一个标量“总广义成本”（通勤时间、金钱成本、摩擦项；必要时加拥堵/同伴效应等相互作用项）。  
  这里的 \(E\) 不是热学里的“能量单位”，而是你在模型里定义的**代价/负效用**。

只要你给出了 \(E(x)\)，后续章节就能把“约束”写成可计算的概率分布（M1/M3/M4），并用势函数/对数归一化项组织推导与误差分析。

### 2) 两类约束：硬约束 vs 软约束
1) **硬约束（fixed total）**：把某个总量严格固定（例如封闭城市里 \(N\) 固定；或把“总出行次数/总预算”固定）。  
   在统计物理的最小语言里，这对应“只在满足约束的集合上计数”。所谓“在给定 \(E\) 的集合里计数”，指的是：只考虑那些满足总成本恰为 \(E\)（或落在很窄区间）的微观态，然后计算它们的数量 \(\Omega(E,\dots)\)，并用 \(S=k_B\ln\Omega\) 把计数变成可加的状态函数。
   例如：若把 \(E\) 理解为某个时间窗内的“总通勤时间/总出行预算”，那么 \(\Omega(E)\) 计数的就是所有满足该总成本约束的个体选择配置数量。

2) **软约束（fixed average / via multipliers）**：更常见的是允许总量波动，但把“平均水平”控制住（例如只要求平均通勤成本、平均迁移成本、平均事件数匹配观测）。  
   这时约束会以拉格朗日乘子进入分布：\(\beta\) 控制“对成本的敏感度”，\(\mu\) 控制“系统规模 \(N\)”的平均水平（开放系统）。典型的权重形式是
   \[
   p(x,N)\propto \exp[-\beta(E(x,N)-\mu N)].
   \]
   这里你可以把 \(\mu\) 先理解成“与 \(N\) 对偶的影子价格/拉格朗日乘子”（具体经济含义随问题设定而定：外部机会成本、准入门槛、吸引力基线等）。

### 3) 变量对照表（只保留 mobility 需要的那一层）
| 符号 | 在 mobility 建模里可对应理解为 |
| :--- | :--- |
| \(x\) | 全体个体迁移/出行选择的完整配置 |
| \(N\) | 系统规模：人口/迁移事件数/出行事件数（固定或可变） |
| \(E(x)\) | 该配置的总广义成本（时间、金钱、摩擦、外部性项） |
| \(\beta\) / \(T\) | 成本敏感度/随机性尺度（\(\beta\) 越大越“理性”，\(T\) 越大越“随机”） |
| \(\mu\) | 控制平均 \(N\) 的外参（对偶的影子价格/乘子） |
| Legendre 变换 | “换控制变量”的计算规则：在热力学里是 \(S\leftrightarrow T\)、\(V\leftrightarrow P\) 的切换；在建模上对应把难以直接固定的约束改写为更可控的对偶参数，并用势函数读出响应 |

符号约定（尤其是城市里把 \(E\) 写成“成本/负效用”还是“效用”）见：[[符号约定与映射（本仓库统一：Swendsen 体系）]]。

更完整的“约束—势—可检验预测”的城市落地见：[[约束与控制变量 在城市复杂动力建模中的作用]]。

---

## Part 5：动手时刻（Checklist）

看完了故事，现在请通过以下任务来验证你的掌握程度。

### 必读
- [ ] **Reading Guide**: [[Swendsen_Ch12_Thermodynamics]] (Chapter 12: 12.1-12.4)
  > 点击查看本章核心公式（Legendre 变换）与符号对照。

### 习题 (Exercises)
- [ ] **Written**: `exercises/written/M0_thermo_basics.md`
  - 给定 $U(S,V,N)$，试着手推导出 $F(T,V,N)$ 的全微分形式。
  - 解释为什么 $G$ 常常被称为“自由焓”或在相变中很重要？

### 验收标准
- [ ] 能不看书写出 $dU = TdS - PdV + \mu dN$。
- [ ] 看到“规模可变/开放系统”，能立刻反应出需要使用 $\mu$（或在系综里使用巨配分函数）。
