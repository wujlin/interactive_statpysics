# M1 概率·计数·熵·最大熵（MaxEnt）

> **核心目标**：本章是整个现代统计物理的逻辑起点。我们要学会“**在信息不足时如何做最合理的推断**”。你将掌握从线性约束直接写出指数族分布（Boltzmann/Gibbs）的能力，这将是你处理后续所有复杂系统的通用武器。

## 推荐学习顺序
1. 通读 Introduction 与 Part 1–4，理解 Jaynes 的“推断视角”。
2. 手推一遍 `exercises/written/E01`（从 MaxEnt 导出 Boltzmann）。
3. 跑通 `exercises/notebooks/E01`，看看拉格朗日乘子是如何被数值解出来的。

## 背景最小包（First Principles）
- 我们不是在猜“真实分布”，而是在信息不足时做**最诚实的推断**。
- 计数比动力学更稳：在宏观约束下，“可能的微观态有多少”往往比“系统怎么走”更关键。
- 只要约束是线性的，最大熵的解就是指数族（这会贯穿后续所有系综）。

## 逻辑桥接（M0 → M1）
- M0 给了你宏观记账语法（势函数与偏导），但还没回答“微观态概率从何而来”。
- M1 用熵与最大熵把“宏观约束”翻译成“微观分布”，这是统计物理真正起步的地方。

---

## Introduction

在 M0 中我们建立了热力学势的语言。但当我们把这套宏观语言应用到微观粒子（或城市个体）时，一个巨大的**历史困境**出现了：
微观力学方程（牛顿方程或薛定谔方程）在时间上是完全可逆的。如果把电影倒放，原路返回的粒子完全遵守物理定律。
**但是**，宏观世界却充满了不可逆：墨水滴入水中会扩散，但绝不会自发聚拢；城市早高峰的拥堵一旦形成，也绝不会自发消散。

这个“微观可逆 vs 宏观不可逆”的矛盾（Loschmidt Paradox），曾让 Boltzmann 备受攻击。他的反击不仅挽救了热力学，更开创了一种全新的世界观：**我们观测到的“定律”，其实只是“大概率事件”的集合。**

## References
- Jaynes 1957：导读见 [Seminal papers](/references/seminal_papers)（条目：`SP-M1-Jaynes1957-I`；想深入可再读 `SP-M1-Jaynes1957-II`）。
- Boltzmann 1877：导读见 [Seminal papers](/references/seminal_papers)（条目：`SP-M1-Boltzmann1877`）。

---

## Part 1：上帝在扔骰子吗？不，他在计数

Boltzmann 的洞见是：宏观不可逆并不需要一条“趋向平衡的力”，它来自计数上的压倒性优势。给定同样的宏观约束，平衡态对应的微观实现方式数（多重度 \(\Omega\)）通常远大于有序态；系统的随机演化因此几乎总把你带向 \(\Omega\) 更大的那一类宏观态（可对照 Context：[[Boltzmann 不可逆性与概率解释（历史语境）]]）。

### Interactive：熵与计数（可选）
不要只相信直觉，请亲自试一试。
下方有两个盒子（左L/右R）。初始时所有 50 个球都在左边（高度有序）。
点击 **Start Mixing**，系统会随机挑选一个球移动到另一边。请观察：
1. 球会自发地变得左右均匀吗？
2. 一旦均匀（~25/25）后，它还能自发回到全在左边的状态吗？

<InteractiveConcept type="entropy-counter" />

### 关键观察
你刚才看到的不可逆过程，并没有依靠近任何“趋向平衡的力”。甚至可以说，根本没有“热力学第二定律”这条硬性规则，有的只是**概率的碾压**。
- 全左状态（$N_L=50, N_R=0$）：$\Omega = 1$ 种方式。
- 均匀状态（$N_L=25, N_R=25$）：$\Omega = \frac{50!}{25!25!} \approx 1.26 \times 10^{14}$ 种方式。

这就是为什么熵 $S = k \ln \Omega$ 总是增加：**系统只是在不知不觉中流向了那种“有更多种活法”的状态。**

如果要把这段直觉写成可推导的公式，核心对象是宏观态对应的多重度 \(\Omega\) 及其对数 \(S=k\ln\Omega\)。相关定义与计算工具见：[[微观态与宏观态 Microstate vs macrostate]]、[[多重度 multiplicity Ω]]、[[熵 Entropy]]、[[Stirling 近似 Stirling approximation]]。

---

## Part 2：Jaynes 的选择——在无知中保持诚实

现在问题来了：如果系统不仅受粒子数守恒约束，还受**能量守恒**（或平均能量）约束，如果你不知道每个粒子的具体位置，你应该猜它在什么状态？

1957年，Jaynes 提出：如果你选了一个熵（不确定性）不是最大的分布，这意味着你在没有证据的情况下，隐式地假设了系统“偏好”其内部的某些结构。
**最大熵原理（MaxEnt）**告诉我们：在满足约束的所有可能分布中，熵最大的那个是**最诚实（Most Honest）**、偏见最少（Least Biased）的推断。

形式化的定义与推导路径可对照：[[Shannon 熵与最大熵原则]] 与 Context 卡 [[Jaynes 1957：最大熵作为推断（信息论视角）]]。

---

## Part 3：拉格朗日乘子的机器

如何求最大熵？这是一个标准的变分问题。我们有目标函数 \(S[p]\) 和约束条件（归一化、平均能量等）。
**拉格朗日乘子法**是解决这个问题的标准机器。

神奇的是，只要约束是线性的（例如 \(\sum p_i E_i = \bar{E}\)），MaxEnt 的解永远属于**指数族（Exponential Family）**：
\[ p(x) = \frac{1}{Z} \exp\left( - \sum_k \lambda_k f_k(x) \right) \]

其中归一化常数 **\(Z\)**（配分函数）起到了至关重要的作用：
\[ Z(\lambda_1, \dots) = \sum_x \exp\left( - \sum_k \lambda_k f_k(x) \right) \]
它不仅保证了概率和为 1，更重要的是它编码了系统的全部信息。你会发现 \(-\frac{\partial \ln Z}{\partial \lambda_k}\) 正好给出了约束量的期望值。这解释了为什么在求出 \(Z\) 之后，一切热力学量（能量、熵、涨落）都能通过简单的求导得到。

这里的乘子 \(\lambda_k\) 正好对应热力学里的强度量（如 \(\beta = 1/kT\)）。这一步推导打通了数学优化与物理实在的任督二脉。

通用模板与示例推导分别见：[[最大熵推出指数族分布（通用模板）]]、[[Boltzmann 分布的最大熵推导]]。

---

## Part 4：城市映射——OD 矩阵推断

MaxEnt 在城市科学里最著名的应用就是 **OD 矩阵推断（Origin-Destination Estimation）**。
- **微观态**：每个人具体的出发地 \(i\) 和目的地 \(j\)。
- **约束**：你只知道每个小区的出发总量 \(O_i\) 和到达总量 \(D_j\)（比如来自手机信令或地铁闸机）。
- **推断**：流量矩阵 \(T_{ij}\) 应该长什么样？

用 MaxEnt 推导，你会发现最合理的猜测是 \(T_{ij} = A_i O_i B_j D_j\)（重力模型的原型）。这不仅是模型，这是**信息甚至真理的边界**——除非你有更多数据（如各交通方式的成本约束），否则你不能假设比这更多的结构。

更细的“微观态/约束/可检验预测”映射见：[[最大熵（MaxEnt）→ OD 矩阵推断]]。

---

## 通往下一章（M2/M3）
- **M2 微正则**：当约束是“硬固定”（如总能量/总资源），MaxEnt 的自然落点就是“等概率计数”。
- **M3 正则**：当约束是“软固定”（与热库交换），指数族直接变成 Boltzmann 权重与配分函数。

## Part 5：动手时刻 (Checklist)

### 必读
- [ ] **Reading Guide**: [[Swendsen_Ch5_Probability]] (Chapter 5: 5.1-5.6)
  > 重点理解：信息缺失（Information deficiency）如何导致概率描述。
- [ ] **Seminal Paper**: 读一遍 Jaynes 1957 的 Abstract 和 Introduction。

### 习题
- [ ] **Written**: `exercises/written/E01_maxent_to_boltzmann.md`
  - 手推一遍：从 \(S\) 和 \(\langle E \rangle\) 约束导出 \(p \propto e^{-\beta E}\)。这是基本功。
- [ ] **Notebook**: `exercises/notebooks/E01_maxent_discrete_numeric.ipynb`
  - 跑通代码，试着改变约束值（平均骰子点数），看 \(\lambda\) 如何变化。

### 验收标准
- [ ] 看到“已知均值为 \(\bar{x}\)”，能脱口而出“最大熵分布是指数分布（正实数）”。
- [ ] 明白为什么 Gaussian 分布是“已知方差”时的最大熵分布。
- [ ] 能够解释：为什么 \(Z\)（配分函数）是乘子 \(\lambda\) 的核心？
