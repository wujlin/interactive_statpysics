下面给你一套**“不漏项、不卡壳、主线分明”**的模块 Checklist。它严格沿着你要的主线走：

**热力学（宏观约束）→ 熵/最大熵（概率建模）→ 系综（把约束写成分布）→ 配分函数/势（可计算的核心对象）→ 涨落/响应（不确定性与敏感性）→ 相互作用/相变（涌现与阈值）→ 随机过程/非平衡（流动与演化）→ 数值算法（把模型跑起来）**

为保证“交互式 project”真的能用，每个模块都固定交付四类东西（只写必要的）：

* **KB 卡片**：Concept / Derivation / Method / Urban-mapping（按需出现，不强行凑数）
* **习题**：Written（手推/概念）+ Notebook（可运行）+ Test（自动检查）
* **最小城市主线**：这一模块最适合承载的城市动力学知识主线（不扩展到其他模块）
* **完成标准**：过关条件（保证你不是“看完了”，而是“会用了”）

> 你可以直接把每条 checklist 变成 issue / task（例如 GitHub Projects 或 Notion/Linear），做到“做完就打勾”。

---

## M0 热力学骨架

**本模块目的**：把“宏观约束的语言”练熟，后面所有系综都只是在换控制变量。

### 你需要掌握的主线点

* 状态函数与微分形式：(dU, dS, dF, dG)
* Legendre 变换 = “换控制变量”
* 化学势 (\mu) 的地位（为 M4 做铺垫）

### Checklist

**阅读/整理**

* [ ] 梳理并写清：状态函数/过程量、可逆/不可逆、第一/第二定律（只写最少公式与一句直觉）
* [ ] 写清：四个势 (U,F,H,G) 之间的关系与“各自自然变量”（这是后续推导模板）

**KB 卡片（必须）**

* [ ] Concept：`Thermodynamic potentials (U,F,H,G) 与自然变量`
* [ ] Concept：`Chemical potential μ 的物理意义与出现方式`
* [ ] Derivation：`从 dU 出发推 dF/dG（Legendre 变换骨架版）`
* [ ] Method：`热力学公式快速检查：量纲/极限/符号（正定性/凸性）`
* [ ] Urban-mapping：`“约束/控制变量”在城市问题里的对应（总出行量、预算/时间、噪声强度）`

**习题（必须）**

* [ ] Written：给定 (U(S,V,N))，写出 (dU) 并标出 (T,P,\mu) 的定义
* [ ] Written：用 Legendre 变换把“固定 (S)”切到“固定 (T)”（写出骨架步骤）
* [ ] Notebook（可选但推荐）：做一个“log-sum-exp = 自由能”最小演示（给后续 logit 做直觉准备）

**完成标准**

* [ ] 你能不看书写出：(dU = T,dS - P,dV + \mu,dN)，并解释每一项“谁是约束/谁是响应”
* [ ] 你能说清：为什么统计物理最后都在算 (\ln Z)（因为它是势/生成函数）

**本模块城市主线**

* “城市模型”的第一语言：**约束与控制变量**（固定总人口/固定平均出行成本/固定 OD 边际等）

---

## M1 概率、计数、熵、最大熵

**本模块目的**：把“约束 → 分布”的桥打通（最大熵/最概然），为所有系综做统一入口。

### 主线点

* 宏观约束下的最少偏见：最大熵
* 最大熵 + 线性约束 → 指数族（后面处处出现）

### Checklist

**阅读/整理**

* [ ] 概率、组合计数、Stirling 近似（只保留推导骨架与使用条件）
* [ ] Boltzmann 熵与 Shannon 熵的关系（只保留“为什么是 log”与“可加性”）

**KB 卡片（必须）**

* [ ] Concept：`Microstate/Macrostate 与 multiplicity Ω`
* [ ] Concept：`Boltzmann entropy S = k ln Ω`
* [ ] Concept：`Shannon entropy 与最大熵原则`
* [ ] Derivation：`最大熵推出 Boltzmann/指数族分布（拉格朗日乘子法）`
* [ ] Method：`拉格朗日乘子法：如何写约束、如何解乘子、如何做一致性检查`
* [ ] Urban-mapping：`最大熵在城市：边际约束 → OD/选择概率（为 M4 项目铺垫）`

**习题（必须）**

* [ ] Written：用最大熵推导“给定平均能量”时的 (p(x)\propto e^{-\beta E(x)})（只写关键变分步骤）
* [ ] Written：解释“为什么最大熵不是拍脑袋”：它是在已知信息外不引入额外结构
* [ ] Notebook：给定离散状态 + 线性约束，数值解最大熵分布并验证约束满足
* [ ] Test：检查数值解满足（误差阈值内）约束、且分布归一化

**完成标准**

* [ ] 看到“约束（平均值/边际）”，你能立刻写出指数形式，并知道“乘子 = 约束的共轭量”

**本模块城市主线**

* **最大熵推断**：已知一些统计量（边际、均值成本）→ 推断最合理的流动/选择分布

---

## M2 微正则系综（孤立系统）

**本模块目的**：建立“熵作为状态计数”的严格地基，让温度/化学势从偏导自然冒出来。

### 主线点

* 微正则：固定 ((E,V,N)) → 等概率
* (S(E,V,N)=k\ln\Omega)，宏观量由偏导定义

### Checklist

**阅读/整理**

* [ ] 微正则定义与适用条件（孤立、等概率假设的角色）
* [ ] 从 (S=k\ln\Omega) 出发定义 (T,P,\mu)（偏导符号写对）

**KB 卡片（必须）**

* [ ] Concept：`Microcanonical ensemble 与 Ω(E,V,N)`
* [ ] Derivation：`T,P,μ 作为熵的偏导定义（写出完整变量保持不变的记号）`
* [ ] Method：`热力学极限：为什么大系统下涨落相对变小`
* [ ] Urban-mapping：`微正则的城市类比（固定总资源/总预算的“闭系统”基线）`

**习题（必须）**

* [ ] Written：给一个简单计数模型（例如两箱分球），写出 (\Omega) 与 (S)，并找最概然宏观态
* [ ] Written：解释“热力学极限下最概然≈平均”的条件

**完成标准**

* [ ] 你能清楚区分：(\Omega) 是计数对象、(S) 是 log 计数、(T) 是偏导定义，不混用

**本模块城市主线**

* **闭系统基线**：在“资源/人口总量固定”的理想化条件下，宏观量如何从计数/约束产生（为后面开放系统做对照）

---

## M3 正则系综 + 配分函数 (Z)

**本模块目的**：把“系统 + 热浴”变成可计算对象 (Z)，并建立“(\ln Z) 生成一切”的操作技能。

### 主线点

* 正则：(p(x)\propto e^{-\beta E(x)})
* (Z=\sum_x e^{-\beta E(x)})，(F=-kT\ln Z)
* 平均值/涨落来自 (\ln Z) 的导数

### Checklist

**阅读/整理**

* [ ] 正则系综的推导路线（任选其一并写清：微正则子系统推导 或 最大熵推导）
* [ ] (\ln Z) 与势 (F) 的关系、以及导数给出平均量的规则

**KB 卡片（必须）**

* [ ] Concept：`Canonical ensemble（β 的含义与控制变量）`
* [ ] Concept：`Partition function Z 与 Free energy F`
* [ ] Derivation：`从正则分布到 F=-kT ln Z（以及 <E> 的导数表达）`
* [ ] Method：`Metropolis-Hastings（详细平衡、接受率、收敛的最小诊断）`
* [ ] Urban-mapping：`Logit/softmax = Boltzmann；log-sum-exp = “自由能/势”`

**习题（必须）**

* [ ] Written：证明 (\langle E\rangle = -\partial_{\beta}\ln Z)
* [ ] Written：写出能量涨落与二阶导的关系（只写公式与一句解释）
* [ ] Notebook：实现 Metropolis 抽样一个简单能量函数并验证均值/方差
* [ ] Test：均值/方差落在理论值误差阈值内；自相关/有效样本量给出最小报告

**完成标准**

* [ ] 给定一个能量/代价函数 (E(x))，你能选择：要么写 (Z) 求解析，要么 MCMC 采样求数值

**本模块城市主线**

* **选择模型的统计物理化**：目的地/路线选择 = Boltzmann/softmax；“势”= log-sum-exp（可作为估计与比较模型的核心对象）

---

## M4 巨正则系综 + 可变粒子数（连接 OD/人口流动）

**本模块目的**：把“数量可变”纳入统一框架（(\mu)），并把最大熵 OD 项目正式落地。

### 主线点

* 巨正则：(p(x,N)\propto e^{-\beta(E(x,N)-\mu N)})
* (\Xi=\sum_N e^{\beta\mu N} Z_N)，(\ln\Xi) 生成 (\langle N\rangle) 与涨落

### Checklist

**阅读/整理**

* [ ] 巨正则分布与 (\Xi) 的定义
* [ ] (\mu) 控制平均数量与涨落的规则（写出导数关系）

**KB 卡片（必须）**

* [ ] Concept：`Grand canonical ensemble（μ 的控制作用）`
* [ ] Derivation：`<N> 与 Var(N) 从 lnΞ 的导数得到（写出表达）`
* [ ] Method：`IPF/Iterative proportional fitting（最大熵 OD 的数值解法）`
* [ ] Urban-mapping：`μ 在城市：总出行强度/进入退出/总体规模的共轭控制量`

**项目（必须）**

* [ ] Project P01：最大熵 OD（边际约束 (O_i,D_j)；可选加入成本先验 (e^{-\beta c_{ij}})）
* [ ] Test：检查 OD 的行和/列和满足边际；检查非负；检查收敛准则

**习题（必须）**

* [ ] Written：解释“边际约束 + 最大熵”为什么自然产生 OD 的乘子形式
* [ ] Notebook：对同一组边际，比较（无成本 prior）vs（带成本 prior）的 OD 结构差异

**完成标准**

* [ ] 你能把“OD 推断”写成：约束 → 乘子 → 指数形式 → IPF 求解 → 校验边际

**本模块城市主线**

* **人口/出行数量可变的开放系统建模**：用 (\mu) 或等价的乘子控制规模；最大熵 OD 作为“平衡态基线模型”

---

## M5 涨落—响应—相关（不确定性与敏感性）

**本模块目的**：学会用协方差/二阶导来做敏感性分析与不确定性度量（这对城市政策/干预评估很关键）。

### 主线点

* 协方差 = 势函数的二阶信息（在指数族里尤其清晰）
* 响应（导数）= 受扰动后平均量如何变化
* 相关函数 = 结构信息（空间/网络相关）

### Checklist

**阅读/整理**

* [ ] 从 (\ln Z) / (\ln\Xi) 得到方差、协方差的通用模板
* [ ] 线性响应的最小形式（“改一个外场/参数→均值怎么变”）

**KB 卡片（必须）**

* [ ] Concept：`Fluctuation-response：方差/协方差与导数的关系`
* [ ] Concept：`Correlation function（时间/空间/网络的最小定义）`
* [ ] Derivation：`Var(E) 与热容的关系（或更一般：Cov 与二阶导）`
* [ ] Method：`MCMC 误差估计：自相关时间/阻塞法（blocking）`
* [ ] Urban-mapping：`城市参数敏感性：β（噪声/理性度）、成本扰动、边际扰动对流量的影响`

**习题（必须）**

* [ ] Written：给一个指数族分布，写出均值对参数的导数等于协方差的证明骨架
* [ ] Notebook：对 P01 的 OD 模型做“扰动实验”（改变成本或 β），画出流量变化与不确定性指标
* [ ] Test：对误差估计模块做基本一致性测试（例如自相关时间为正、ESS 合理）

**完成标准**

* [ ] 你能回答：哪个参数/约束的微小改变，会引起最大的宏观流量变化（定性+可计算）

**本模块城市主线**

* **政策/冲击的敏感性与不确定性**：把“扰动”变成“响应”，把“波动”变成可量化的误差/风险

---

## M6 相互作用与平均场（从独立个体到外部性）

**本模块目的**：让你能处理“个体间相互影响/外部性”（拥堵、同伴效应、聚集偏好），并用平均场/自由能地形建立直觉。

### 主线点

* 相互作用 → 不可因子分解 → 集体行为
* 平均场：用自洽方程近似复杂相互作用
* 自由能地形与序参量

### Checklist

**阅读/整理**

* [ ] 选一个最小相互作用模型（推荐 Ising 作为模板）
* [ ] 平均场近似的推导骨架与适用边界

**KB 卡片（必须）**

* [ ] Concept：`Interacting systems 与因子分解何时失效`
* [ ] Concept：`Order parameter（序参量）与自由能地形`
* [ ] Derivation：`Ising 平均场自洽方程（写出关键近似与自洽步骤）`
* [ ] Method：`Ising 的 MCMC 实现与观测量计算（磁化/能量/热容）`
* [ ] Urban-mapping：`外部性映射：拥堵/同伴效应/聚集偏好 → 有效相互作用项`

**习题/实验（必须）**

* [ ] Notebook：实现 Ising MCMC，在不同温度下测磁化/能量
* [ ] Test：对小尺寸系统做 sanity check（例如极低温趋于有序、极高温趋于无序）

**完成标准**

* [ ] 你能说清：相互作用项会如何改变分布结构（多峰、相变前兆、路径依赖）

**本模块城市主线**

* **外部性建模**：从“独立选择（logit）”升级到“相互影响系统”（拥堵、社交模仿、聚集/分化）

---

## M7 相变与标度（阈值、韧性、临界）

**本模块目的**：把“涌现阈值”变成可识别、可测量的结构（序参量、相关长度、有限尺寸效应）。

### 主线点

* 相变：宏观性质非解析变化（或近似尖峰/突变）
* 临界：相关长度发散、幂律、标度
* 有限尺寸：真实系统的可观测替代指标

### Checklist

**阅读/整理**

* [ ] 相变类型、临界点的基本表征（序参量/热容/ susceptibility）
* [ ] 有限尺寸效应（为什么模拟里“发散”变成“峰值”）

**KB 卡片（必须）**

* [ ] Concept：`Phase transition 的最小定义与可观测信号`
* [ ] Concept：`Correlation length 与幂律/标度的直觉`
* [ ] Derivation：`有限尺寸下“峰值替代发散”的逻辑（定性+关键公式）`
* [ ] Method：`寻找临界点：峰值/交叉点/Binder cumulant（选其一做主线方法）`
* [ ] Urban-mapping：`城市阈值：拥堵崩塌/连通性断裂/级联失败 → 相变式信号`

**习题/实验（必须）**

* [ ] Notebook：基于 M6 的 Ising 数据，做一次“临界附近峰值/数据对比”的最小分析
* [ ] Test：分析流程可重复运行并产出同类结论（结果允许数值差，但流程不应崩）

**完成标准**

* [ ] 你能把“阈值现象”说清楚：哪个观测量是序参量、哪个量会出现峰值、为何需要有限尺寸视角

**本模块城市主线**

* **阈值与韧性**：把“系统突然变坏/变好”的经验描述，变成可测的临界信号与结构解释

---

## M8 随机过程与主方程（城市流动的动力学语言）

**本模块目的**：从“静态分布”走向“演化方程”，直接对接人口迁移/状态转移/OD 动态。

### 主线点

* Markov 过程：状态—转移率
* Master equation：概率随时间演化
* 稳态、细致平衡、净流（非平衡的最小证据）

### Checklist

**阅读/整理**

* [ ] 离散状态 Markov 链与连续时间 Markov 过程（只保留你要用的版本）
* [ ] 稳态分布求法（线性代数/特征向量视角）

**KB 卡片（必须）**

* [ ] Concept：`Markov chain / transition matrix / stationary distribution`
* [ ] Concept：`Master equation（离散/连续时间的写法）`
* [ ] Concept：`Detailed balance 与 steady-state flux（净流）`
* [ ] Derivation：`从转移率写出 Master equation（符号与守恒写清）`
* [ ] Method：`模拟主方程：矩阵推进 / Gillespie（若用连续时间则选 Gillespie）`
* [ ] Urban-mapping：`区际迁移/活动状态转移：状态=区域或活动；转移=迁移率`

**项目（必须，最小版即可）**

* [ ] 构造一个“城市区域 Markov 迁移模型”（合成或真实小规模）
* [ ] 计算稳态分布 + 计算每条边净流
* [ ] Test：稳态满足 ( \pi = \pi P )（或连续时间版本），总概率守恒

**完成标准**

* [ ] 你能判断一个流动系统是否满足细致平衡；不满足时能用“净流环/循环流”描述其不可逆性

**本模块城市主线**

* **人口流动作为 Markov 动力系统**：从“OD 分布”升级为“OD 的时间演化/迁移率模型”

---

## M9 Fokker–Planck / Langevin（连续近似与噪声动力学）

**本模块目的**：把 M8 的离散动力学连续化，得到“漂移-扩散 + 噪声”的可分析/可模拟形式。

### 主线点

* Langevin（SDE）↔ Fokker–Planck（概率密度 PDE）
* 稳态分布与势函数（在可积情形下）
* 数值模拟：Euler–Maruyama

### Checklist

**阅读/整理**

* [ ] 漂移项（drift）与扩散项（diffusion）的含义
* [ ] SDE 与 Fokker–Planck 的对应关系（只写最小对应，不展开 Ito/Stratonovich 细节）

**KB 卡片（必须）**

* [ ] Concept：`Langevin equation（drift + noise）`
* [ ] Concept：`Fokker–Planck equation（density evolution）`
* [ ] Derivation：`从 Langevin 到 FP 的对应关系（写“形式对应”即可）`
* [ ] Method：`Euler–Maruyama 数值模拟 + 稳态检验方法`
* [ ] Urban-mapping：`连续化城市量：密度场/需求强度/拥堵水平的随机演化`

**习题/实验（必须）**

* [ ] Notebook：模拟一个最小 SDE（建议 OU 过程），验证稳态分布与自相关特性
* [ ] Test：稳态均值/方差接近理论值；数值稳定性检查（步长变化不应导致发散）

**完成标准**

* [ ] 你能把一个“宏观城市量”的演化写成：漂移（系统性趋势）+ 扩散（随机波动），并能数值模拟与验证稳态性质

**本模块城市主线**

* **连续流动与噪声**：从“个体迁移率”过渡到“密度/强度的随机动力学”（为更大尺度城市动力建模做桥）

---

# 模块之间的“硬依赖”检查（防止漏学或跳学导致断链）

* [ ] M0 完成后：能熟练读懂 (T,P,\mu) 的偏导定义（否则 M2/M4 会断）
* [ ] M1 完成后：能从约束写出指数族形式（否则 M3/M4 会断）
* [ ] M3 完成后：能用 (\ln Z) 的导数算均值/涨落 或 用 MCMC 估计（否则 M5 会断）
* [ ] M4 完成后：P01 最大熵 OD 跑通并可复现实验（否则“城市主线”不落地）
* [ ] M6+M7 完成后：能用“序参量/峰值/有限尺寸”识别阈值（否则“相变类比”会漂）
* [ ] M8 完成后：能写主方程并求稳态与净流（否则“流动动力学”无法闭环）
* [ ] M9 完成后：能把离散动力学连续化成漂移-扩散并模拟（否则后续非平衡扩展很难）

---

如果你愿意，我下一步可以把这些 checklist **直接落到你仓库模板里**（生成每个模块的 `README.md` + 对应卡片/习题的空白骨架文件名），这样你打开仓库就能按模块一路打勾推进。
